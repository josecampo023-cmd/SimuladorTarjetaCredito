<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Tarjeta de Cr√©dito</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --bg: #0d0f14;
            --surface: #161922;
            --surface2: #1e2230;
            --border: rgba(255,255,255,0.07);
            --accent: #3b82f6;
            --accent2: #06b6d4;
            --accent-glow: rgba(59,130,246,0.25);
            --text: #e8eaf0;
            --text-muted: #6b7280;
            --success: #10b981;
            --warning: #f59e0b;
            --mono: 'JetBrains Mono', monospace;
            --sans: 'Sora', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--sans);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Background mesh */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 60% at 10% 0%, rgba(59,130,246,0.08) 0%, transparent 60%),
                radial-gradient(ellipse 60% 40% at 90% 100%, rgba(6,182,212,0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .wrapper {
            position: relative;
            z-index: 1;
            max-width: 1100px;
            margin: 0 auto;
            padding: 48px 24px 80px;
        }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        header {
            text-align: center;
            margin-bottom: 52px;
        }

        .badge {
            display: inline-block;
            font-family: var(--mono);
            font-size: 11px;
            letter-spacing: 0.15em;
            color: var(--accent2);
            background: rgba(6,182,212,0.08);
            border: 1px solid rgba(6,182,212,0.2);
            padding: 5px 14px;
            border-radius: 20px;
            margin-bottom: 18px;
        }

        h1 {
            font-size: clamp(26px, 4vw, 40px);
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1.2;
            background: linear-gradient(135deg, #fff 30%, #93c5fd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            margin-top: 10px;
            color: var(--text-muted);
            font-size: 15px;
            font-weight: 300;
        }

        /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 36px 40px;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(59,130,246,0.4), transparent);
        }

        /* ‚îÄ‚îÄ FORM GRID ‚îÄ‚îÄ */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px 28px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group.full { grid-column: 1 / -1; }

        label {
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.06em;
            color: var(--text-muted);
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        label .icon {
            width: 16px;
            height: 16px;
            opacity: 0.7;
        }

        input {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-family: var(--mono);
            font-size: 14px;
            padding: 13px 16px;
            transition: border-color 0.2s, box-shadow 0.2s;
            width: 100%;
            outline: none;
        }

        input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        input::placeholder { color: var(--text-muted); font-family: var(--sans); font-size: 13px; }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.5);
            cursor: pointer;
        }

        /* ‚îÄ‚îÄ SECTION SEPARATOR ‚îÄ‚îÄ */
        .section-title {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.12em;
            color: var(--accent2);
            text-transform: uppercase;
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* ‚îÄ‚îÄ ACTIONS ‚îÄ‚îÄ */
        .actions {
            display: flex;
            gap: 12px;
            margin-top: 28px;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 13px 26px;
            border-radius: 10px;
            font-family: var(--sans);
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--accent);
            color: #fff;
            box-shadow: 0 4px 20px rgba(59,130,246,0.3);
        }

        .btn-primary:hover {
            background: #2563eb;
            box-shadow: 0 6px 28px rgba(59,130,246,0.45);
            transform: translateY(-1px);
        }

        .btn-primary:active { transform: translateY(0); }

        .btn-outline {
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-outline:hover {
            border-color: rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.04);
            transform: translateY(-1px);
        }

        /* ‚îÄ‚îÄ ERROR ‚îÄ‚îÄ */
        .error-msg {
            margin-top: 14px;
            padding: 12px 16px;
            background: rgba(239,68,68,0.08);
            border: 1px solid rgba(239,68,68,0.2);
            border-radius: 10px;
            color: #fca5a5;
            font-size: 13px;
            display: none;
        }

        .error-msg.show { display: block; }

        /* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
        #resultSection {
            margin-top: 40px;
            animation: fadeUp 0.4s ease;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(16px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .results-title {
            font-size: 18px;
            font-weight: 700;
        }

        /* Summary cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
            margin-bottom: 28px;
        }

        .summary-card {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 18px 20px;
            position: relative;
            overflow: hidden;
        }

        .summary-card::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 2px;
        }

        .summary-card.blue::after  { background: var(--accent); }
        .summary-card.cyan::after  { background: var(--accent2); }
        .summary-card.green::after { background: var(--success); }
        .summary-card.amber::after { background: var(--warning); }

        .summary-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .summary-value {
            font-family: var(--mono);
            font-size: 17px;
            font-weight: 500;
            color: var(--text);
        }

        /* Table */
        .table-wrap {
            overflow-x: auto;
            border-radius: 14px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        thead th {
            background: var(--surface2);
            padding: 13px 16px;
            text-align: right;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            text-transform: uppercase;
            white-space: nowrap;
            border-bottom: 1px solid var(--border);
        }

        thead th:first-child { text-align: center; border-radius: 14px 0 0 0; }
        thead th:nth-child(2) { text-align: left; }
        thead th:last-child  { border-radius: 0 14px 0 0; }

        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background 0.15s;
        }

        tbody tr:last-child { border-bottom: none; }
        tbody tr:hover { background: rgba(255,255,255,0.025); }

        tbody td {
            padding: 12px 16px;
            text-align: right;
            font-family: var(--mono);
            font-size: 12.5px;
            color: #d1d5db;
        }

        tbody td:first-child { text-align: center; color: var(--text-muted); font-size: 12px; }
        tbody td:nth-child(2) { text-align: left; font-family: var(--sans); font-size: 12.5px; color: var(--text); font-weight: 500; }

        .td-total { color: var(--text) !important; font-weight: 600 !important; }

        /* loading spinner */
        .spinner {
            width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,0.2);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            display: none;
        }
        .btn-primary.loading .spinner { display: inline-block; }
        .btn-primary.loading .btn-text { display: none; }

        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 600px) {
            .form-grid { grid-template-columns: 1fr; }
            .card { padding: 24px 20px; }
            .form-group.full { grid-column: 1; }
        }
    </style>
</head>
<body>
<div class="wrapper">

    <header>
        <div class="badge">HERRAMIENTA FINANCIERA</div>
        <h1>Simulador de Tarjeta de Cr√©dito</h1>
        <p class="subtitle">Proyecta el costo real de tus compras a cuotas, incluyendo cuota de manejo</p>
    </header>

    <div class="card">
        <form class="form-grid" onsubmit="return false;">

            <div class="section-title">Datos de la compra</div>

            <div class="form-group">
                <label>üí∞ Valor de la compra (COP)</label>
                <input type="text" id="valorCompra" placeholder="Ej: 9,000,000">
            </div>

            <div class="form-group">
                <label>üìÜ N√∫mero de cuotas</label>
                <input type="number" id="cuotas" placeholder="Ej: 12" min="1">
            </div>

            <div class="section-title">Tasas de inter√©s</div>

            <div class="form-group">
                <label>üìä Tasa mensual pactada (%)</label>
                <input type="text" id="tasaPactada" placeholder="Ej: 1.87">
            </div>

            <div class="form-group">
                <label>üìà Tasa efectiva anual (%)</label>
                <input type="text" id="tasaEA" placeholder="Ej: 24.97">
            </div>

            <div class="section-title">Cuota de manejo y fechas</div>

            <div class="form-group">
                <label>üè¶ Cuota de manejo mensual (COP)</label>
                <input type="text" id="cuotaManejo" placeholder="Ej: 18,900 (opcional)">
            </div>

            <div class="form-group">
                <label>üìÖ Fecha de inicio</label>
                <input type="date" id="fechaInicio">
            </div>

            <div class="form-group">
                <label>üîÅ Fecha de corte</label>
                <input type="date" id="fechaCorte">
            </div>

        </form>

        <div class="actions">
            <button class="btn btn-primary" id="btnSimular" onclick="simularCredito()">
                <div class="spinner"></div>
                <span class="btn-text">‚ö° Simular cr√©dito</span>
            </button>
            <button class="btn btn-outline" id="btnDescargar" onclick="descargarPDF()" style="display:none;">
                üì• Descargar PDF
            </button>
        </div>

        <div class="error-msg" id="mensajeError"></div>
    </div>

    <!-- RESULT SECTION -->
    <div id="resultSection" style="display:none;">
        <div class="results-header">
            <span class="results-title">Detalle de la simulaci√≥n</span>
        </div>

        <div class="summary-grid" id="summaryGrid"></div>

        <div class="table-wrap">
            <table id="tablaResultado">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Mes / A√±o</th>
                        <th>Cuota (capital + inter√©s)</th>
                        <th>Inter√©s</th>
                        <th>Abono Capital</th>
                        <th>Cuota Manejo</th>
                        <th>Total a Pagar</th>
                        <th>Saldo Restante</th>
                    </tr>
                </thead>
                <tbody id="tablaBody"></tbody>
            </table>
        </div>
    </div>

</div>


<script>
    // ‚îÄ‚îÄ‚îÄ Globals ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let lastResult = null;
    let lastParams = {};

    // ‚îÄ‚îÄ‚îÄ Main simulation call ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function simularCredito() {
        const btn = document.getElementById('btnSimular');
        const errDiv = document.getElementById('mensajeError');

        errDiv.classList.remove('show');
        errDiv.textContent = '';
        btn.classList.add('loading');

        const datos = {
            valorCompra:     document.getElementById('valorCompra').value.trim(),
            tasaPactada:     document.getElementById('tasaPactada').value.trim(),
            tasaEAFacturada: document.getElementById('tasaEA').value.trim(),
            cuotas:          parseInt(document.getElementById('cuotas').value),
            fechaInicio:     document.getElementById('fechaInicio').value,
            fechaCorte:      document.getElementById('fechaCorte').value,
            cuotaManejo:     document.getElementById('cuotaManejo').value.trim()
        };

        lastParams = {
            valorCompra:  datos.valorCompra,
            tasaMensual:  datos.tasaPactada + '%',
            tasaEA:       datos.tasaEAFacturada + '%',
            cuotas:       datos.cuotas,
            cuotaManejo:  datos.cuotaManejo || '$ 0',
            fechaInicio:  datos.fechaInicio,
            fechaCorte:   datos.fechaCorte
        };

        try {
            const response = await fetch('http://localhost:8080/api/calculadora/simular', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datos)
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.errors?.[0]?.detail || 'Error desconocido');
            }

            const resultado = await response.json();
            lastResult = resultado;
            mostrarResultado(resultado);
        } catch (err) {
            errDiv.textContent = '‚ùå ' + err.message;
            errDiv.classList.add('show');
        } finally {
            btn.classList.remove('loading');
        }
    }

    // ‚îÄ‚îÄ‚îÄ Render results ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function mostrarResultado(data) {
        // Summary cards
        const summaryGrid = document.getElementById('summaryGrid');
        summaryGrid.innerHTML = `
            <div class="summary-card blue">
                <div class="summary-label">Total pagado</div>
                <div class="summary-value">${data.totalPagado}</div>
            </div>
            <div class="summary-card cyan">
                <div class="summary-label">Total intereses</div>
                <div class="summary-value">${data.totalIntereses}</div>
            </div>
            <div class="summary-card amber">
                <div class="summary-label">Total cuota manejo</div>
                <div class="summary-value">${data.totalCuotaManejo}</div>
            </div>
            <div class="summary-card green">
                <div class="summary-label">N√∫mero de cuotas</div>
                <div class="summary-value">${data.cuotas.length}</div>
            </div>
        `;

        // Table body
        const tbody = document.getElementById('tablaBody');
        tbody.innerHTML = '';
        data.cuotas.forEach(c => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${c.numero}</td>
                <td>${c.mesAnio}</td>
                <td>${c.valorCuota}</td>
                <td>${c.interes}</td>
                <td>${c.abonoCapital}</td>
                <td>${c.cuotaManejo}</td>
                <td class="td-total">${c.totalCuota}</td>
                <td>${c.saldoRestante}</td>
            `;
            tbody.appendChild(tr);
        });

        document.getElementById('resultSection').style.display = 'block';
        document.getElementById('btnDescargar').style.display = 'inline-flex';
        document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // ‚îÄ‚îÄ‚îÄ PDF con jsPDF + AutoTable ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function descargarPDF() {
        if (!lastResult) return;

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ orientation: 'landscape', unit: 'mm', format: 'a4' });

        const W = doc.internal.pageSize.getWidth();   // 297mm
        const azul       = [30,  58, 138];  // #1e3a8a
        const azulClaro  = [219, 234, 254];  // #dbeafe
        const gris       = [100, 116, 139];  // #64748b
        const grisClaro  = [248, 250, 252];  // #f8fafc
        const blanco     = [255, 255, 255];
        const negro      = [15,  23,  42];   // #0f172a
        const verde      = [6,   78,  59];
        const ambar      = [120, 53,  15];
        const cyan       = [14, 116, 144];

        const fecha = new Date().toLocaleDateString('es-CO', {
            year: 'numeric', month: 'long', day: 'numeric'
        });

        // ‚îÄ‚îÄ ENCABEZADO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // Barra azul superior
        doc.setFillColor(...azul);
        doc.rect(0, 0, W, 22, 'F');

        doc.setTextColor(...blanco);
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(15);
        doc.text('Simulador de Tarjeta de Credito', 14, 10);

        doc.setFont('helvetica', 'normal');
        doc.setFontSize(8.5);
        doc.setTextColor(180, 200, 255);
        doc.text('Proyeccion de pagos a cuotas ‚Äî Tabla de amortizacion', 14, 17);

        doc.setTextColor(180, 200, 255);
        doc.setFontSize(8);
        doc.text('Generado el ' + fecha, W - 14, 13, { align: 'right' });

        let y = 30;

        // ‚îÄ‚îÄ PAR√ÅMETROS (2 filas √ó 4 col) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(7.5);
        doc.setTextColor(...gris);
        doc.text('PARAMETROS DE LA SIMULACION', 14, y);
        y += 4;

        const params = [
            ['Valor de la compra', lastParams.valorCompra],
            ['Tasa mensual pactada', lastParams.tasaMensual],
            ['Tasa EA facturada', lastParams.tasaEA],
            ['Numero de cuotas', String(lastParams.cuotas)],
            ['Cuota de manejo mensual', lastParams.cuotaManejo || '$ 0'],
            ['Fecha de inicio', lastParams.fechaInicio],
            ['Fecha de corte', lastParams.fechaCorte],
        ];

        const boxW = (W - 28) / 4;
        const boxH = 13;

        params.forEach(([label, value], i) => {
            const col = i % 4;
            const row = Math.floor(i / 4);
            const bx = 14 + col * (boxW + 2);
            const by = y + row * (boxH + 2);

            doc.setFillColor(...grisClaro);
            doc.roundedRect(bx, by, boxW, boxH, 2, 2, 'F');

            // L√≠nea izquierda azul
            doc.setFillColor(...azul);
            doc.rect(bx, by, 2, boxH, 'F');

            doc.setFont('helvetica', 'normal');
            doc.setFontSize(6.5);
            doc.setTextColor(...gris);
            doc.text(label.toUpperCase(), bx + 5, by + 4.5);

            doc.setFont('helvetica', 'bold');
            doc.setFontSize(8.5);
            doc.setTextColor(...negro);
            doc.text(String(value), bx + 5, by + 10);
        });

        y += Math.ceil(params.length / 4) * (boxH + 2) + 6;

        // ‚îÄ‚îÄ RESUMEN (4 tarjetas) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(7.5);
        doc.setTextColor(...gris);
        doc.text('RESUMEN', 14, y);
        y += 4;

        const summary = [
            { label: 'TOTAL PAGADO',       value: lastResult.totalPagado,      color: azul  },
            { label: 'TOTAL INTERESES',    value: lastResult.totalIntereses,   color: cyan  },
            { label: 'TOTAL CUOTA MANEJO', value: lastResult.totalCuotaManejo, color: ambar },
            { label: 'N.¬∞ CUOTAS',         value: String(lastResult.cuotas.length), color: verde },
        ];

        const cardW = (W - 28) / 4;
        const cardH = 16;

        summary.forEach(({ label, value, color }, i) => {
            const cx = 14 + i * (cardW + 2);
            doc.setFillColor(...color);
            doc.roundedRect(cx, y, cardW, cardH, 2, 2, 'F');

            doc.setFont('helvetica', 'normal');
            doc.setFontSize(6.5);
            doc.setTextColor(200, 210, 240);
            doc.text(label, cx + 5, y + 5.5);

            doc.setFont('helvetica', 'bold');
            doc.setFontSize(9.5);
            doc.setTextColor(...blanco);
            doc.text(value, cx + 5, y + 12.5);
        });

        y += cardH + 8;

        // ‚îÄ‚îÄ TABLA DE AMORTIZACI√ìN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(7.5);
        doc.setTextColor(...gris);
        doc.text('TABLA DE AMORTIZACION', 14, y);
        y += 3;

        const head = [['#', 'Mes / A√±o', 'Cuota (cap+int)', 'Interes', 'Abono Capital', 'Cuota Manejo', 'Total a Pagar', 'Saldo Restante']];

        const body = lastResult.cuotas.map(c => [
            String(c.numero),
            c.mesAnio,
            c.valorCuota,
            c.interes,
            c.abonoCapital,
            c.cuotaManejo,
            c.totalCuota,
            c.saldoRestante
        ]);

        doc.autoTable({
            head,
            body,
            startY: y,
            margin: { left: 14, right: 14 },
            tableWidth: 'auto',
            styles: {
                font: 'helvetica',
                fontSize: 8,
                cellPadding: { top: 3, right: 5, bottom: 3, left: 5 },
                textColor: negro,
                lineColor: [226, 232, 240],
                lineWidth: 0.2,
            },
            headStyles: {
                fillColor: azul,
                textColor: blanco,
                fontStyle: 'bold',
                fontSize: 7.5,
                halign: 'center',
            },
            columnStyles: {
                0: { halign: 'center', cellWidth: 10 },
                1: { halign: 'left',   cellWidth: 30, fontStyle: 'bold' },
                2: { halign: 'right' },
                3: { halign: 'right' },
                4: { halign: 'right' },
                5: { halign: 'right' },
                6: { halign: 'right', fontStyle: 'bold', textColor: azul },
                7: { halign: 'right' },
            },
            alternateRowStyles: {
                fillColor: grisClaro,
            },
            didParseCell(data) {
                // √öltima fila: resaltar totales
                if (data.row.index === body.length - 1) {
                    data.cell.styles.fillColor = azulClaro;
                    data.cell.styles.fontStyle = 'bold';
                }
            },
            // Pie de p√°gina en cada hoja
            didDrawPage(data) {
                const pg = doc.internal.getCurrentPageInfo().pageNumber;
                const total = '{total_pages_count_string}';
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(...gris);
                doc.text(
                    'Simulador de Tarjeta de Credito  ‚Äî  Pagina ' + pg,
                    14,
                    doc.internal.pageSize.getHeight() - 6
                );
                doc.text(
                    'Los valores son de caracter informativo y pueden variar segun su entidad financiera.',
                    W - 14,
                    doc.internal.pageSize.getHeight() - 6,
                    { align: 'right' }
                );
                // L√≠nea separadora del pie
                doc.setDrawColor(...azulClaro);
                doc.setLineWidth(0.4);
                doc.line(14, doc.internal.pageSize.getHeight() - 10, W - 14, doc.internal.pageSize.getHeight() - 10);
            }
        });

        // Reemplazar placeholder de total de p√°ginas
        if (typeof doc.putTotalPages === 'function') {
            doc.putTotalPages('{total_pages_count_string}');
        }

        doc.save('Simulacion_Credito.pdf');
    }
</script>
</body>
</html>
